# WorkMirror Agent 配置文件

app:
  name: "workmirror-agent"
  version: "v0.2.0-alpha.1"
  log_level: "info" # debug, info, warn, error
  language: "zh" # 语言偏好：zh (中文) / en (English)，影响 AI prompt 和报告生成语言
  # 日志落盘路径（默认写入程序目录下 ./logs/）；相对路径以可执行文件目录为基准。
  # 如需仅输出到 stdout，请不要配置该字段。
  # log_path: "./logs/mirror.log"

# 采集器配置
collector:
  poll_interval_ms: 500 # 窗口轮询间隔 (毫秒)
  min_duration_sec: 3 # 最小记录时长 (秒)，低于此值的窗口切换会被忽略
  buffer_size: 2048 # 事件缓冲区大小
  flush_batch_size: 100 # 批量写入阈值
  flush_interval_sec: 5 # 强制刷新间隔 (秒)
  session_idle_min: 6 # idle >= X 分钟则切分新会话

# Diff 采集配置
diff:
  enabled: true
  watch_paths: [] # 监控的项目目录，为空则不启用
  extensions:
    [
      ".go",
      ".py",
      ".js",
      ".ts",
      ".jsx",
      ".tsx",
      ".vue",
      ".java",
      ".rs",
      ".c",
      ".cpp",
    ]
  buffer_size: 512
  debounce_sec: 2 # 防抖时间（秒）

# 浏览器采集配置
browser:
  enabled: true
  poll_interval_sec: 30 # 轮询间隔（秒）
  history_path: "" # Chrome History 路径（为空则自动检测）

# 存储配置
storage:
  # 便携目录分发建议保持默认：DB 跟随程序目录（相对路径以可执行文件目录为基准）。
  db_path: "./data/workmirror.db"

# AI API 配置
ai:
  # 供应商选择：default, openai, anthropic, google, zhipu
  # - default: 使用内置免费服务（无需配置 API Key）
  # - openai: OpenAI 兼容格式（支持 OpenRouter、DeepSeek、硅基流动、自建 NewAPI 等）
  # - anthropic: Anthropic Claude 格式
  # - google: Google Gemini 格式
  # - zhipu: 智谱 BigModel v4 格式（官方与多数代理使用 /api/paas/v4/chat/completions）
  provider: "default"

  # 内置免费服务配置（当 provider 为 "default" 时生效）
  # 注意：内置服务由作者提供，数据会经过云端处理；协议为 OpenAI 兼容（POST {base_url}/v1/chat/completions）
  # 如需完全本地控制，请配置 openai/anthropic/google 并使用自己的 API Key
  default:
    enabled: true
    # base_url 由作者内置或构建注入；如你自建 OpenAI 兼容网关，也可以直接填自己的地址。
    base_url: "https://gpt.devbin.de/proxy/mirror"
    # api_key 可选（如果你的网关不需要 key，就留空）。
    # api_key: ""
    model: "llama-3.3-70b"

  # OpenAI 兼容格式配置（当 provider 为 "openai" 时生效）
  # 支持 DeepSeek、OpenRouter、硅基流动、Azure OpenAI、自建 NewAPI 等
  openai:
    api_key: "${OPENAI_API_KEY}"
    base_url: "https://api.openai.com" # 或 https://api.deepseek.com、https://openrouter.ai/api 等
    model: "gpt-4o-mini" # 或 deepseek-chat、claude-3-5-sonnet 等

  # Anthropic Claude 配置（当 provider 为 "anthropic" 时生效）
  anthropic:
    api_key: "${ANTHROPIC_API_KEY}"
    base_url: "https://api.anthropic.com"
    model: "claude-sonnet-4-20250514"

  # Google Gemini 配置（当 provider 为 "google" 时生效）
  google:
    api_key: "${GOOGLE_API_KEY}"
    base_url: "https://generativelanguage.googleapis.com"
    model: "gemini-1.5-flash"

  # 智谱 BigModel v4 配置（当 provider 为 "zhipu" 时生效）
  zhipu:
    api_key: "${ZHIPU_API_KEY}"
    base_url: "https://open.bigmodel.cn/api/paas/v4"
    model: "glm-4.5-flash"

  # SiliconFlow Embedding & Reranker（用于 RAG，独立于 LLM）
  siliconflow:
    api_key: "${SILICONFLOW_API_KEY}"
    base_url: "https://api.siliconflow.cn/v1"
    embedding_model: "BAAI/bge-large-zh-v1.5"
    reranker_model: "BAAI/bge-reranker-v2-m3"

# 隐私配置（默认开启：Local-first & Privacy by default）
privacy:
  enabled: true
  # patterns 为正则表达式列表；匹配到的内容会被替换为 "***"。
  # 注意：URL query/fragment 会在 URL 级别默认清空（保留域名与 "/..." 以支持证据链解释）。
  patterns:
    - "(?i)\\b(email|e-mail)\\b[:=]\\s*\\S+"
    - "[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}"
    - "(?i)\\b(password|passwd|pwd)\\b[:=]\\s*\\S+"
    - "(?i)\\b(api[_-]?key|token|access[_-]?token|refresh[_-]?token|secret|authorization)\\b[:=]\\s*\\S+"
